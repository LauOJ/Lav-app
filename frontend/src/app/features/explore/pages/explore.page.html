<section class="explore-page" [class.sheet-open]="selectedWc()">
  <form class="search-panel" (submit)="onSearchLocation(); $event.preventDefault()">
    <input
      type="text"
      placeholder="Buscar lugar o direcci√≥n"
      [value]="searchQuery()"
      (input)="searchQuery.set($any($event.target).value)"
      aria-label="Buscar lugar o direcci√≥n"
    />
    <button type="submit" [disabled]="searchLoading()">Buscar</button>
  </form>
  <div class="filters-panel" role="group" aria-label="Filtros del mapa">
    <div class="filters-quick">
      <button
        type="button"
        class="filter-pill"
        [class.active]="filters().accessible"
        [attr.aria-pressed]="filters().accessible"
        (click)="onToggleFilter('accessible', !filters().accessible)"
        aria-label="Accesible"
      >
        <app-lucide-icon icon="accessibility" />
      </button>
      <button
        type="button"
        class="filter-pill"
        [class.active]="filters().gender_neutral"
        [attr.aria-pressed]="filters().gender_neutral"
        (click)="onToggleFilter('gender_neutral', !filters().gender_neutral)"
        aria-label="Neutral"
      >
        <app-lucide-icon icon="non-binary" />
      </button>
      <button
        type="button"
        class="filter-pill"
        [class.active]="filters().has_changing_table"
        [attr.aria-pressed]="filters().has_changing_table"
        (click)="onToggleFilter('has_changing_table', !filters().has_changing_table)"
        aria-label="Cambiador"
      >
        <app-lucide-icon icon="baby" />
      </button>
      <button
        type="button"
        class="filter-pill"
        [class.active]="filters().only_for_customers"
        [attr.aria-pressed]="filters().only_for_customers"
        (click)="onToggleFilter('only_for_customers', !filters().only_for_customers)"
        aria-label="Solo clientes"
      >
        <app-lucide-icon icon="lock" />
      </button>
      <button
        type="button"
        class="filter-pill"
        [class.active]="filters().has_intimate_hygiene_products"
        [attr.aria-pressed]="filters().has_intimate_hygiene_products"
        (click)="onToggleFilter('has_intimate_hygiene_products', !filters().has_intimate_hygiene_products)"
        aria-label="Higiene √≠ntima"
      >
        <app-lucide-icon icon="droplets" />
      </button>
      <button
        type="button"
        class="filter-pill filter-toggle"
        [class.active]="showAdvancedFilters()"
        [attr.aria-pressed]="showAdvancedFilters()"
        (click)="onToggleAdvancedFilters()"
        aria-label="Mostrar filtros avanzados"
      >
        {{ showAdvancedFilters() ? '-' : '+' }}
      </button>
    </div>
    @if (showAdvancedFilters()) {
      <div class="filters-advanced">
        <div class="filter-cleanliness">
          <span class="filter-cleanliness-label">
            Limpieza:
            @if (filters().minCleanliness === null) {
              sin filtro
            } @else {
              ‚â• {{ filters().minCleanliness }}
            }
          </span>
          <input
            type="range"
            min="1"
            max="5"
            step="1"
            [value]="filters().minCleanliness ?? 1"
            (input)="onSetMinCleanliness($any($event.target).valueAsNumber)"
            aria-label="Limpieza m√≠nima"
          />
          @if (filters().minCleanliness !== null) {
            <button
              type="button"
              class="filter-clear"
              (click)="onSetMinCleanliness(null)"
            >
              Quitar
            </button>
          }
        </div>
      </div>
    }
  </div>
  <button
    type="button"
    class="locate-button"
    (click)="onLocateUser()"
    aria-label="Centrar en mi ubicaci√≥n"
    title="Centrar en mi ubicaci√≥n"
  >
    üìç
  </button>

  <app-map-view
    [wcs]="filteredWcs()"
    [selectedWcId]="selectedWcId()"
    [userLocation]="userLocation()"
    (wcSelected)="onSelectWc($event)"
    (addWcAt)="onAddWcAt($event)"
  ></app-map-view>

  @if (loading()) {
    <div class="status-banner">Cargando WCs...</div>
  }

  @if (error()) {
    <div class="status-banner error">{{ error() }}</div>
  }

  @if (searchError()) {
    <div class="status-banner error">{{ searchError() }}</div>
  }

  @if (geoError()) {
    <div class="status-banner error">{{ geoError() }}</div>
  }

  @if (showEmptyState()) {
    <div class="status-banner empty">
      No hay WCs que cumplan estos filtros. Prueba a desactivar alg√∫n filtro.
    </div>
  }

  @if (selectedWc()) {
    <app-wc-detail-sheet
      [wc]="selectedWc()!"
      [userLocation]="userLocation()"
      (close)="onCloseSheet()"
    ></app-wc-detail-sheet>
  }
</section>
