<aside
  class="sheet"
  [class.scrollable]="isExpanded() && showReviews()"
  role="dialog"
  aria-label="Detalle del WC"
  (click)="onSheetClick($event)"
>
  <button type="button" class="handle-button" (click)="onExpand()">
    <span class="handle"></span>
  </button>
  <h2 class="title" (click)="onExpand()">{{ wc().name }}</h2>

  <app-wc-feature-icons [wc]="wc()" />

  <div class="actions">
    @if (!isExpanded()) {
      <button type="button" class="primary" (click)="onExpand()">
        Ver mÃ¡s
      </button>
    }
    <button type="button" class="secondary" (click)="onClose()">Cerrar</button>
  </div>

  @if (isExpanded()) {
    <div class="ratings">
      <div class="rating">
        <span class="label">Limpieza</span>
        <div class="rating-visual">
          <span class="stars" [attr.aria-label]="cleanlinessAria()">
            {{ cleanlinessStars() }}
          </span>
          @if (wc().reviews_count > 0) {
            <span class="rating-number">
              {{ wc().avg_cleanliness | number: '1.1-1' }}
            </span>
          } @else {
            <span class="rating-number muted">Sin valoraciones</span>
          }
        </div>
      </div>

      <div class="rating">
        <span class="label">Privacidad</span>
        <div class="rating-visual">
          <span class="stars" [attr.aria-label]="safetyAria()">
            {{ safetyStars() }}
          </span>
          @if (wc().reviews_count > 0) {
            <span class="rating-number">
              {{ wc().avg_safety | number: '1.1-1' }}
            </span>
          } @else {
            <span class="rating-number muted">Sin valoraciones</span>
          }
        </div>
      </div>

      <div class="reviews-count">
        @if (wc().reviews_count > 0) {
          <span class="reviews-text">ðŸ’¬ {{ wc().reviews_count }} reviews</span>
        } @else {
          <span class="reviews-text muted">Sin valoraciones</span>
        }
      </div>
    </div>

    <div class="cta">
      <button type="button" class="primary" (click)="onToggleReviews()">
        {{ showReviews() ? 'Ocultar reviews' : 'Ver reviews' }}
      </button>
    </div>

    @if (showReviews()) {
      <section class="reviews">
        @if (reviewsLoading()) {
          <p class="muted">Cargando reviews...</p>
        } @else if (reviewsError()) {
          <p class="muted">{{ reviewsError() }}</p>
        } @else if (reviews().length === 0) {
          <p class="muted">TodavÃ­a no hay reviews</p>
        } @else {
          <ul class="review-list">
            @for (review of reviews(); track review.id) {
              <li class="review-item">
                <div class="review-metrics">
                  <div class="review-metric">
                    <span class="review-label">Limpieza</span>
                    <span class="review-stars">
                      {{ reviewStars(review.cleanliness_rating) }}
                    </span>
                    <span class="review-score">
                      {{ review.cleanliness_rating }}/5
                    </span>
                  </div>
                  <div class="review-metric">
                    <span class="review-label">Privacidad</span>
                    <span class="review-stars">
                      {{ reviewStars(review.safety_rating) }}
                    </span>
                    <span class="review-score">
                      {{ review.safety_rating }}/5
                    </span>
                  </div>
                </div>
                @if (review.comment) {
                  <p class="review-comment">{{ review.comment }}</p>
                }
                @if (review.created_at) {
                  <span class="review-date">
                    {{ review.created_at | date: 'dd/MM/yy' }}
                  </span>
                }
              </li>
            }
          </ul>
        }
      </section>
    }
  }
</aside>
